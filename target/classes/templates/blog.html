<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="_fragments :: head(~{::title})">
    <meta charset="UTF-8">
    <meta name="viewpoint" content="width-device-width, initial-scale=1.0">
    <title>Blog</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel="stylesheet" href="../static/css/typo.css">
    <link rel="stylesheet" href="../static/css/animate.css">
    <link rel="stylesheet" href="../static/lib/prism/prism.css">
    <link rel="stylesheet" href="../static/lib/tocbot/tocbot.css">
    <link rel="stylesheet" href="../static/css/style.css">

</head>
<body>
    <!--nav bar-->
    <nav th:replace="_fragments :: menu(1)" class="ui inverted attached segment m-padded-tb-mini m-shadow-small">
        <div class="ui container">
            <!--menu item-->
            <div class="ui inverted secondary stackable menu">
                <h2 class="ui teal header item">Blog</h2>
                <a href="#" class="m-item item m-mobile-hide"><i class="small home icon"></i>Home</a>
                <a href="#" class="m-item item m-mobile-hide"><i class="small idea icon"></i>types</a>
                <a href="#" class="m-item item m-mobile-hide"><i class="small tags icon"></i>Tags</a>
                <a href="#" class="m-item item m-mobile-hide"><i class="small clone icon"></i>Archive</a>
                <a href="#" class="m-item item m-mobile-hide"><i class="small info icon"></i>About</a>
                <!--search bar-->
                <div class="right item m-mobile-hide">
                    <div class="ui icon inverted transparent input">
                        <input type="text" placeholder="Search..."></input>
                        <i class="search link icon"></i>
                    </div>
                </div>
            </div>
        </div>
        <a href="#" class="ui menu toggle black icon button m-right-top m-mobile-show">
            <i class="sidebar icon"></i>
        </a>
    </nav>

    <!--    content-->
    <div class="m-container-small m-padded-tb-large animate__animated animate__fadeIn">
        <div class="ui container">
            <!--top-->
            <div class="ui top attached segment">
                <div class="ui horizontal link list">
                    <div class="item">
                        <img src="https://picsum.photos/100/100?image=103" th:src="@{${blog.user.avatar}}"   alt="" class="ui avatar image">
                        <div class="content"><a href="#" class="header" th:text="${blog.user.nickname}">Haotian Xu</a></div>
                    </div>
                    <div class="item">
                        <i class="calendar icon"></i> <span th:text="${#dates.format(blog.updateTime,'dd/MM/yyyy')}">01/01/2021</span>
                    </div>
                    <div class="item">
                        <i class="eye icon"></i> <span th:text="${blog.views}">369</span>
                    </div>
                </div>
            </div>
            <!--banner-->
            <div class="ui attached segment">
                <img src="https://picsum.photos/800/450" th:src="@{${blog.firstPicture}}"  alt="" class="ui fluid rounded image">
            </div>
            <!--content-->
            <div id="waypoint"  class="ui attached padded segment">
                <div class="ui right aligned basic segment">
                    <div class="ui orange basic label" th:text="${blog.flag}">Project</div>
                </div>

                <h2 class="ui center aligned header" th:text="${blog.title}">Article Title</h2>

                <div id="content" class="typo typo-selection js-toc-content m-padded-lr-responsive m-padded-tb-large" th:utext="${blog.content}">
                    <h2 id="title1">Title 1</h2>
                    <h3 id="title2">Title 2</h3> <p>Lorem ipsum dolor sit amet. Maecenas non tortor nisl. Ut venenatis mattis hendrerit. Vivamus in consectetur erat. Proin venenatis, augue at gravida blandit, ante justo egestas velit, non cursus ligula elit ullamcorper massa. Morbi leo eros, porttitor vel mollis vel, pellentesque et dui. Curabitur non leo non tellus aliquam sollicitudin at sit amet leo. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Maecenas non nibh eu leo pulvinar semper et ut lacus. Sed sit amet lacinia massa.
                    <pre><code class="language-css">p { color: red }</code></pre>
                    <h3 id="title3">Title 3</h3> <p> Cras quis felis. Mauris aliquam nunc ut sodales tempor. Nam gravida sapien non cursus aliquet. Proin ac orci enim. Vivamus et scelerisque lacus, posuere lacinia erat. Fusce feugiat non dolor at ultrices. Interdum et malesuada fames ac ante ipsum primis in faucibus. Praesent euismod libero eu felis faucibus, et sodales erat placerat. Cras lacus quam, accumsan et rhoncus at, finibus in elit. Duis quam risus, consectetur sagittis lobortis id, malesuada quis dui. Nulla sed fermentum lectus, in aliquet lacus. Duis et pharetra metus.
                    <h2 id="title4">Title 4</h2>
                    <p> Phasellus elementum odio lorem, quis hendrerit risus aliquam eu.Aenean ut eros dictum, porttitor quam nec, posuere felis. Etiam a ultricies est, in dignissim ex. In accumsan est in luctus pulvinar. Cras libero orci, aliquet vitae justo non, accumsan tincidunt lorem. Phasellus a dictum magna. Praesent luctus fringilla elit quis congue. Ut quis dolor malesuada, feugiat velit vitae, laoreet lacus. Nullam elementum vitae mauris sit amet tincidunt. Mauris sodales dictum semper. Praesent auctor libero arcu, non maximus odio consequat nec. Nullam venenatis mi non massa suscipit aliquam.
                    <p>Nullam ullamcorper tempus egestas.</p><p> Duis ultricies libero ut risus mattis, a sollicitudin odio mattis. Nunc vitae neque eu tellus fringilla porta in a eros. Sed consequat ipsum in pellentesque vulputate. Suspendisse lobortis magna in ipsum vehicula, sed dignissim augue tincidunt. Phasellus vehicula varius ipsum, nec elementum eros pellentesque eget. Vestibulum eget aliquam orci, vitae fringilla lectus.
                    <p>Sed id sem arcu. Nam id maximus lorem.</p><p> Donec aliquet lorem et lobortis ultricies. Praesent ac felis dapibus, cursus augue sollicitudin, suscipit ex. Nam aliquam non nulla tincidunt vulputate. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Sed vestibulum dapibus enim et sollicitudin. Mauris faucibus metus sed metus luctus tempus.</p>
                </div>
                <!--tag-->
                <div class="m-padded-lr-responsive">
                    <div class="ui basic teal left pointing label" th:each="tag : ${blog.tags}" th:text="${tag.name}">Tech</div>
                </div>
                <!--donation-->
                <div class="ui center aligned basic segment">
                    <button id="payButton" class="ui orange basic circular button">Donate</button>
                </div>
                <div class="ui payArea flowing popup transition hidden">
                    <div class="ui orange basic label">
                        <div class="ui images" style="font-size: inherit !important;">
                            <div class="image">
                                <img src="/images/wechat.png" th:src="@{/images/wechat.jpg}"  alt="" class="ui rounded bordered image" style="width: 120px">
                                <div>WeChat Pay</div>
                            </div>
                            <div class="image">
                                <img src="/images/wechat.png" th:src="@{/images/wechat.jpg}"  alt="" class="ui rounded bordered image" style="width: 120px">
                                <div>PayPal</div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--message-->
                <div class="ui attached positive message">
                    <div class="ui middle aligned grid">
                        <div class="eleven wide column">
                            <ui class="list">
                                <li>Author: <span th:text="${blog.user.nickname}">Haotian Xu</span><a href="#" th:href="@{/about}" target="_blank">（about me）</a></li>
                                <li>Date: <span th:text="${#dates.format(blog.updateTime,'dd/MM/yyyy HH:mm')}">2021-01-02 11:22</span> </li>
                                <li>License: MIT</li>
                            </ui>
                        </div>
                        <div class="five wide column">
                            <img src="/images/wechat.png" th:src="@{/images/wechat.jpg}"  alt="" class="ui right floated rounded bordered image" style="width: 110px">
                        </div>
                    </div>

                </div>
                <!--comments-->
                <div class="ui bottom attached segment">
                    <!--comments list-->
                    <div id="comment-container" class="ui teal segment">
                        <div th:fragment="commentList">
                            <div class="ui comments">
                                <h3 class="ui dividing header" style="max-width: 100%;">Comments</h3>
                                <div class="comment" th:each="comment : ${comments}">
                                    <a class="avatar">
                                        <img src="https://picsum.photos/100/100?image=100" th:src="@{${comment.avatar}}">
                                    </a>
                                    <div class="content">
                                        <a class="author">
                                            <span th:text="${comment.nickname}">Matt</span>
                                            <div class="ui mini basic teal left pointing label m-padded-mini" th:if="${comment.adminComment}">Mod</div>
                                        </a>
                                        <div class="metadata">
                                            <span class="date"th:text="${#dates.format(comment.createTime,'dd/MM/yyyy HH:mm')}">Today at 5:42PM</span>
                                        </div>
                                        <div class="text"th:text="${comment.content}">
                                            How artistic!
                                        </div>
                                        <div class="actions">
                                            <a class="reply" data-commentid="1" data-commentnickname="Matt" th:attr="data-commentid=${comment.id},data-commentnickname=${comment.nickname}" onclick="reply(this)">Reply</a>
                                        </div>
                                    </div>
                                    <!--nest-->
                                    <div class="comments" th:if="${#arrays.length(comment.replyComments)}>0">
                                        <div class="comment" th:each="reply : ${comment.replyComments}">
                                            <a class="avatar">
                                                <img src="https://picsum.photos/100/100?image=100" th:src="@{${reply.avatar}}">
                                            </a>
                                            <div class="content">
                                                <a class="author">
                                                    <span th:text="${reply.nickname}">Matt</span>
                                                    <div class="ui mini basic teal left pointing label m-padded-mini" th:if="${reply.adminComment}">Mod</div>
                                                    &nbsp;<span th:text="|@ ${reply.parentComment.nickname}|" class="m-teal">@ John</span>
                                                </a>
                                                <div class="metadata">
                                                    <span class="date"th:text="${#dates.format(reply.createTime,'dd/MM/yyyy HH:mm')}">Today at 5:42PM</span>
                                                </div>
                                                <div class="text"th:text="${reply.content}">
                                                    How artistic!
                                                </div>
                                                <div class="actions">
                                                    <a class="reply" data-commentid="1" data-commentnickname="Matt" th:attr="data-commentid=${reply.id},data-commentnickname=${reply.nickname}" onclick="reply(this)">Reply</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--/*-->
                                <div class="comment">
                                    <a class="avatar">
                                        <img src="https://picsum.photos/100/100?image=101">
                                    </a>
                                    <div class="content">
                                        <a class="author">Elliot Fu</a>
                                        <div class="metadata">
                                            <span class="date">Yesterday at 12:30AM</span>
                                        </div>
                                        <div class="text">
                                            <p>This has been very useful for my research. Thanks as well!</p>
                                        </div>
                                        <div class="actions">
                                            <a class="reply">Reply</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="comment">
                                    <a class="avatar">
                                        <img src="https://picsum.photos/100/100?image=103">
                                    </a>
                                    <div class="content">
                                        <a class="author">Joe Henderson</a>
                                        <div class="metadata">
                                            <span class="date">5 days ago</span>
                                        </div>
                                        <div class="text">
                                            Dude, this is awesome. Thanks so much
                                        </div>
                                        <div class="actions">
                                            <a class="reply">Reply</a>
                                        </div>
                                    </div>
                                </div>
                                <!--*/-->
                            </div>
                        </div>
                    </div>

                    <div id="comment-form" class="ui form">
                        <input type="hidden" name="blog.id" th:value="${blog.id}">
                        <input type="hidden" name="parentComment.id" value="-1">
                        <div class="field">
                            <textarea name="content" placeholder="Leave your message here."></textarea>
                        </div>
                        <div class="fields">
                            <div class="field m-mobile-wide m-margin-bottom-small">
                                <div class="ui left icon input">
                                    <i class="user icon"></i>
                                    <input type="text" name="nickname" placeholder="Name" th:value="${session.user}!=null ? ${session.user.nickname}"></input>
                                </div>
                            </div>
                            <div class="field m-mobile-wide m-margin-bottom-small">
                                <div class="ui left icon input">
                                    <i class="mail icon"></i>
                                    <input type="text" name="email" placeholder="Email" th:value="${session.user}!=null ? ${session.user.email}"></input>
                                </div>
                            </div>
                            <div class="field m-mobile-wide m-margin-bottom-small">
                                <button id="commentpost-btn" type="button" class="ui teal basic button m-mobile-wide"><i class="send small icon"></i>Post</button>
                            </div>
                        </div>


                    </div>

                </div>

            </div>
        </div>
    </div>
    <br>
    <br>
    <br>
    <div id="toolbar" class="m-padded m-fixed m-right-bottom" style="display: none">
        <div class="ui vertical icon buttons">
            <button type="button" class="ui toc teal button"><i class="book icon"></i></button>
            <a href="#comment-container" class="ui teal button"><i class="comments icon"></i></a>
            <button class="ui wechatqr icon button"><i class="wechat icon"></i></button>
            <div id="toTop-button" href="#" class="ui icon button"><i class="chevron up icon"></i></div>
        </div>
    </div>

    <div class="ui toc-container payArea flowing popup transition hidden" style="width: 200px !important;">
        <ol class="js-toc">

        </ol>
    </div>

    <div id="qrcode" class="ui wechat-qr flowing popup transition hidden" style="width: 130px !important;">
<!--        <img src="./static/images/wechat.png" alt="" class="ui rounded image" style="width: 200px !important">-->
    </div>


    <!--    footer-->
    <footer th:replace="_fragments :: footer" class="ui inverted vertical segment m-padded-tb-massive">
        <div class="ui center aligned container">
            <div class="ui inverted divided stackable grid">
                <div class="three wide column">
                    <div class="ui inverted link list">
                        <div class="item">
                            <img src="/images/wechat.png" th:href="@{/images/wechat.png}"  class="ui rounded image" alt="" style="width: 100px">
                        </div>
                    </div>
                </div>
                <div class="three wide column">
                    <h4 class="ui inverted header m-text-thin m-text-spaced">Latest Blog</h4>
                    <div class="ui inverted link list">
                        <a href="#" class="item">Daily Updates 1</a>
                        <a href="#" class="item">Daily Updates 2</a>
                        <a href="#" class="item">Daily Updates 3</a>
                    </div>
                </div>
                <div class="three wide column">
                    <h4 class="ui inverted header m-text-thin m-text-spaced">Contact</h4>
                    <div class="ui inverted link list">
                        <a href="#" class="item">Email: contact@blog.com</a>
                        <a href="#" class="item">Tel: 0412345678</a>
                    </div>
                </div>
                <div class="seven wide column">
                    <h4 class="ui inverted header m-text-thin m-text-spaced">About me</h4>
                    <p class="m-text-thin m-text-spaced m-opacity-mini">Lorem ipsum dolor sit amet, augue salutatus ne per. Nobis option necessitatibus no eum, ea mea modo perpetua, impetus nusquam signiferumque vix ut. Ei eum cibo decore. </p>
                </div>
            </div>
            <div class="ui inverted section divider"></div>
            <p class="m-text-thin m-text-spaced m-opacity-tiny">Copyright© 2020-2021 Haotian Xu. MIT License</p>
        </div>
    </footer>

    <!--/*/<th:block th:replace="_fragments :: script">/*/-->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/jquery.scrollto@2.1.2/jquery.scrollTo.min.js"></script>
    <script src="../static/lib/prism/prism.js"></script>
    <script src="../static/lib/tocbot/tocbot.min.js"></script>
    <script src="../static/lib/qrcode/qrcode.min.js"></script>
    <script src="../static/lib/waypoints/jquery.waypoints.min.js"></script>
    <!--/*/</th:block>/*/-->

    <script th:value="${blog.id}"th:inline="javascript">
        $('.menu.toggle').click(function (){
            $('.m-item').toggleClass('m-mobile-hide');
        });

        $('#payButton').popup({
            popup : $('.payArea.popup'),
            on : 'hover',
            position : 'bottom center'
        });

        tocbot.init({
            // Where to render the table of contents.
            tocSelector: '.js-toc',
            // Where to grab the headings to build the table of contents.
            contentSelector: '.js-toc-content',
            // Which headings to grab inside of the contentSelector element.
            headingSelector: 'h1, h2, h3',
            // For headings inside relative or absolute positioned containers within content.
            hasInnerContainers: true,
        });

        $('.toc.button').popup({
            popup : $('.toc-container.popup'),
            on : 'click',
            position : 'left center'
        });

        $('.wechatqr').popup({
            popup : $('.wechat-qr'),
            on : 'click',
            position : 'left center'
        });

        var serurl = "localhost:8080";
        var url = /*[[@{/blog/{id}(id=${blog.id})}]]*/"";
        var qrcode = new QRCode("qrcode", {
            text: serurl+url,
            width: 110,
            height: 110,
            colorDark : "#000000",
            colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.H
        });

        $('#toTop-button').click(function (){
            $(window).scrollTo(0,500);
        });

        var waypoint = new Waypoint({
            element: document.getElementById('waypoint'),
            handler: function(direction) {
                if (direction =='down'){
                    $("#toolbar").show(500);
                }else{
                    $('#toolbar').hide(500);
                }
                console.log('Scrolled to waypoint!')
            }
        });

        //comment form validation
        $('.ui.form').form({
            fields: {
                title: {
                    identifier: 'content',
                    rules: [{
                        type: 'empty',
                        prompt: 'Empty comment'
                    }
                    ]
                },
                content: {
                    identifier: 'nickname',
                    rules: [{
                        type: 'empty',
                        prompt: 'Empty nickname'
                    }]
                },
                type: {
                    identifier: 'email',
                    rules: [{
                        type: 'email',
                        prompt: 'Empty email'
                    }]
                }
            }
        });

        //load comments
        $(function () {
            $("#comment-container").load(/*[[@{/comments/{id}(id=${blog.id})}]]*/"comments/6");
        });

        $('#commentpost-btn').click(function () {
            var boo = $('.ui.form').form('validate form');
            if (boo) {
                console.log('Validate success');
                postData();
            } else {
                console.log('Validate fail');
            }

        });

        function postData() {
            $("#comment-container").load(/*[[@{/comments}]]*/"",{
                "parentComment.id" : $("[name='parentComment.id']").val(),
                "blog.id" : $("[name='blog.id']").val(),
                "nickname": $("[name='nickname']").val(),
                "email"   : $("[name='email']").val(),
                "content" : $("[name='content']").val()
            },function (responseTxt, statusTxt, xhr) {
                clearContent();
            });
        }

        function clearContent() {
            $("[name='content']").val('');
            $("[name='parentComment.id']").val(-1);
            $("[name='content']").attr("placeholder", "Leave your message here.");
        }

        function reply(obj) {
            var commentId = $(obj).data('commentid');
            var commentNickname = $(obj).data('commentnickname');
            $("[name='content']").attr("placeholder", "@"+commentNickname).focus();
            $("[name='parentComment.id']").val(commentId);
            $(window).scrollTo($('#comment-form'),500);
        }

    </script>
</body>
</html>